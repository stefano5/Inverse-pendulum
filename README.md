# Inverse-pendulum

Work done in a few days, during the quarantine caused by covid ill

Work:
  - CAD design (case)
  - Electronic design (mainly H-bridge)
  - Firmware design (PWM, I2C, Kalman filter, controller)
  - Controller design (PID)
  
Hardware:
- micro: ST nucleo F767ZI
- IMU: MPU 6050
- motors: cheap DC-motor 


## CAD design
A simple case has been made, it is just a structure where the components were mounted.


<p align="center">
  <img src="https://user-images.githubusercontent.com/40228829/169061076-e9b5c335-bc40-4b64-a92f-a5f4688370db.jpeg" width="300">
  <img src="https://user-images.githubusercontent.com/40228829/169061091-6d3ed4a5-0fc6-4374-94db-65656907ab79.jpeg" width="300">
</p>

## Electronic design
Since DC-motors were availeble, a way to control them was needed.
Two H-Bridge have been built, using 2N2222 NPN transistors.
Other two 2N2222 transistor were used to transform the low-current PWMs in power signals in order to use the two motors.

The circuit for one motor was:
![circuit](https://user-images.githubusercontent.com/40228829/169068540-82b2a949-ca5a-4df4-bc1a-dd3e49d793ca.png)

Where S1 and S2 control the direction of the diretion. They must be opposed, if S1 is equal to 1 then S2 must be 0.
The PWM signal is the PWM generated by the MCU nucleo F767ZI, with PSC=256 and ARR=9999.
Each driver for each motor requires 5 2N2222 transistors and 5 resistances (1k OHM).

## Firmware design
Two PWM are used to control the two motors.
I2C are used to read the IMU MPU 6050 (MPU 6050 doesn't have a magnetometers).
A Kalman filter was used to estimate the pitch angle, by using [this useful library](https://github.com/leech001/MPU6050).

A PID has been developed, using the pitch estimated by the kalman filter and also the pitch rate measured by the gyroscope.

A better control tecnique is [here](https://github.com/stefano5/Inverse_pendulum_on_a_unicycle_on_slopes) proposed (it is a model based control, that allow the robot to run even on slopes), but it requires the forward velocity, so an encoder is needed.









